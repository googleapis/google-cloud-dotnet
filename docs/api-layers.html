<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>API layers | Google Cloud APIs </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="API layers | Google Cloud APIs ">
    <meta name="generator" content="docfx 2.14.1.0">
    
    <link rel="shortcut icon" href="favicon.ico">
    <link rel="stylesheet" href="styles/docfx.vendor.css">
    <link rel="stylesheet" href="styles/docfx.css">
    <link rel="stylesheet" href="styles/main.css">
    <meta property="docfx:navrel" content="toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="index.html">
                <img id="logo" class="svg" src="logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="article row grid">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
              <h1 id="api-layers">API layers</h1>
              
<h2 id="introduction">Introduction</h2>
<p>The Google Cloud Platform client libraries have been designed to make simple
operations as simple as possible, without sacrificing fine-grained tuning where
necessary.</p>
<p>This article describes the different abstraction layers of the libraries, and how to take
advantage of each of them at the appropriate time.</p>
<h2 id="background-grpc-and-rest-apis">Background: gRPC and REST APIs</h2>
<p>For a long time, most Google APIs - including those in Google Cloud Platform - have
used a REST-based approach, usually using JSON to represent the resources. These APIs
have been self-describing using the <a href="https://developers.google.com/discovery/">Google API Discovery Service</a>,
which has been used to generate per-API packages under the umbrella of the
<a href="https://developers.google.com/api-client-library/dotnet">&quot;API Client Library for .NET&quot;</a>.</p>
<p>In November 2014, Google introduce gRPC, a new RPC framework offering efficient multi-plexing,
bidirectional streaming and many other features. New APIs are now being provided with access via
either the REST-based HTTP 1.1 and JSON, or gRPC over HTTP 2.0 and
<a href="https://developers.google.com/protocol-buffers/">Protocol Buffers</a>.</p>
<p>The google-cloud-dotnet project provides client libraries for a mixture of these APIs. In particular,
<code>Google.Cloud.Storage.V1</code> and <code>Google.Cloud.BigQuery.V2</code> are hand-written layers over the existing REST-based
libraries for the <a href="https://cloud.google.com/storage">Google Cloud Storage</a> and
<a href="https://cloud.google.com/bigquery">BigQuery</a> APIs, whereas other libraries target gRPC-based APIs.
Where gRPC access to an API is available, our client libraries use it.</p>
<h2 id="layers-of-grpc-based-libraries">Layers of gRPC-based libraries</h2>
<p>All gRPC-based libraries contain generated code, and some also contain hand-written code. The 
generated code comes from three sources:</p>
<ul>
<li><a href="https://github.com/googleapis/toolkit">Google API Tools</a> generation for clients</li>
<li><a href="http://www.grpc.io">gRPC</a> raw RPC service generation</li>
<li><a href="https://developers.google.com/protocol-buffers/">Protocol Buffer</a> generation
for request, response and resource messages and enums</li>
</ul>
<p>To show the layering involved, we&#39;ll use the Google.Datastore.V1 client library as an example.
An application using this library will typically end up with the following assemblies:</p>
<ul>
<li>Google.Datastore.V1: the client library itself</li>
<li>Google.Api.Gax/Google.Api.Gax.Grpc: support libraries providing functionality required across multiple
gRPC-based wrapper libraries, such as <a href="page-streaming.html">page streaming</a>.</li>
<li>Google.Protobuf: Protocol Buffer support library</li>
<li>Grpc.Auth and Grpc.Core: gRPC support libraries</li>
<li>Google.Apis.Auth and Google.Apis.Auth.PlatformServices: support libraries used by both
REST service libraries and gRPC libraries for authentication</li>
<li>Dependencies from the above libraries for HTTP, JSON serialization, cryptography, and
asynchronous sequences</li>
</ul>
<p>Within <code>Google.Datastore.V1</code> there are three abstraction layers, all within
the <code>Google.Datastore.V1</code> namespace, with the following entry points:</p>
<ul>
<li><a href="Google.Datastore.V1/api/Google.Datastore.V1.DatastoreDb.html">DatastoreDb</a> is hand-written code
to provide the most idiomatic experience. For example, using <code>DatastoreDb</code> avoids the project ID
from being specified on every call, and uses the <code>IDisposable</code> pattern to make
<a href="Google.Datastore.V1/api/Google.Datastore.V1.DatastoreTransaction.html">DatastoreTransaction</a>
simple to work with.</li>
<li><a href="Google.Datastore.V1/api/Google.Datastore.V1.DatastoreClient.html">DatastoreClient</a> is generated by the
Google API Tools. This is still a higher level of abstraction than the raw RPC, supporting 
features such as <a href="page-streaming.html">page streaming</a> and automatic creation of requests from the 
constituent parameters, but it has less semantic awareness than the hand-written layer.
An instance of <code>DatastoreClient</code> is available from a <code>DatastoreDb</code> via the
<a href="Google.Datastore.V1/api/Google.Datastore.V1.DatastoreDb.html#Google_Datastore_V1_DatastoreDb_Client">DatastoreDb.Client</a> property if necessary.
Code which does not use <code>DatastoreDb</code> at all can simply call
<a href="Google.Datastore.V1/api/Google.Datastore.V1.DatastoreClient.html#Google_Datastore_V1_DatastoreClient_Create">DatastoreClient.Create()</a> instead.</li>
<li><a href="Google.Datastore.V1/api/Google.Datastore.V1.Datastore.DatastoreClient.html">Datastore.DatastoreClient</a> is
the gRPC-generated RPC access class. Very few applications will need to use this, but an instance can be retrieved
from the higher level <code>DatastoreClient</code> class via the
<a href="Google.Datastore.V1/api/Google.Datastore.V1.DatastoreClient.html#Google_Datastore_V1_DatastoreClient_GrpcClient">DatastoreClient.GrpcClient</a> property if necessary.</li>
</ul>
<p>Additional hand-written code exists in the form of extension methods and additions to the partial 
classes generated by the Protocol Buffer code generator. This does not act as a separate abstraction
layer, but as a set of extensions to the generated code. Examples include the conversion operators on
<a href="Google.Datastore.V1/api/Google.Datastore.V1.Value.html">Value</a>, the static factory methods
in <a href="Google.Datastore.V1/api/Google.Datastore.V1.Filter.html">Filter</a>, the constructors
for <a href="Google.Datastore.V1/api/Google.Datastore.V1.PartitionId.html">PartitionId</a> and
<a href="Google.Datastore.V1/api/Google.Datastore.V1.Query.html">Query</a>, and
<a href="Google.Datastore.V1/api/Google.Datastore.V1.QueryExtensions.html">extension methods</a> for
repeated fields. The extensions certainly don&#39;t have to be used, but they can lead to much simpler code.</p>
<p>Different libraries may include different amounts of wrapping. In Datastore, although the
<code>DatastoreDb</code> abstraction layer helps simplify code by removing redundant specification of
project IDs and allowing mutations to be built up in memory before being committed in a transaction,
the objects used to describe the queries and entities are still the Protocol Buffer messages. In other
APIs, the entities themselves may be wrapped in a hand-written layer to make them easier to work with.
Some libraries may not provide any hand-written code at all: simple APIs are often very usable just
with the code generated by the Google API Tools.</p>
<p>Importantly, these abstraction layers are transparent rather than opaque: if a higher level abstraction
doesn&#39;t provide the level of control you need, you can always use the next level of abstraction down.
This approach allows access to all the features of the API while higher level abstractions are
built incrementally based on feedback.</p>
<h2 id="layers-of-rest-based-libraries">Layers of REST-based libraries</h2>
<p>The REST-based libraries wrap existing generated code provided in other NuGet packages. For example,
<code>Google.Cloud.Storage.V1</code> depends on <code>Google.Apis.Storage.v1</code>. The wrapper libraries exist to provide
a more idiomatic way of working with the APIs than is exposed by the auto-generated code.</p>
<p>Where functionality hasn&#39;t been explicitly wrapped, application code can always access
the underlying REST service.</p>
<p>To show the layering involved, we&#39;ll use the Google.Cloud.Storage.V1 client library as an example.
An application using this library will typically end up with the following assemblies:</p>
<ul>
<li>Google.Cloud.Storage.V1: the wrapper library</li>
<li>Google.Apis.Storage.v1: the REST service library that the wrapper library uses to call the REST API</li>
<li>Google.Api.Gax/Google.Api.Gax.Rest: support libraries providing functionality required across multiple
REST-based wrapper libraries, such as <a href="page-streaming.html">page streaming</a>.</li>
<li>Google.Apis: support libraries used by all REST service libraries
to perform REST-based operations</li>
<li>Google.Apis.Auth and Google.Apis.Auth.PlatformServices: support libraries used by both
REST service libraries and gRPC libraries for authentication</li>
<li>Dependencies from the above libraries for HTTP, logging, JSON serialization, cryptography, and
asynchronous sequences</li>
</ul>
<p>For simple use cases, you can simply use the
<a href="Google.Cloud.Storage.V1/api/Google.Cloud.Storage.V1.StorageClient.html">Google.Cloud.Storage.V1.StorageClient</a> class.
If your application code requires functionality which isn&#39;t wrapped, you can use the
<a href="Google.Cloud.Storage.V1/api/Google.Cloud.Storage.V1.StorageClient.html##Google_Storage_V1_StorageClient_Service">StorageClient.Service</a> property
to obtain a reference to a <code>Google.Apis.Storage.v1.StorageService</code> which can be used
for all other operations. This is the same <code>StorageService</code> object that the <code>StorageClient</code>
uses for its API calls, with whatever authentication information you provided when creating
the client.</p>
<p>The intent is that the most commonly-used functionality should be wrapped, however: if you
find yourself frequently having to dig below the <code>StorageClient</code> abstraction, please
<a href="https://github.com/GoogleCloudPlatform/google-cloud-dotnet/issues/new">file a feature request</a>
with details of what functionality isn&#39;t being wrapped at the moment.</p>

            </article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
             
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="styles/docfx.js"></script>
    <script type="text/javascript" src="styles/main.js"></script>
  </body>
</html>
